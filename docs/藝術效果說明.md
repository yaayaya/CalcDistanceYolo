# 🎨 FlurPaint 藝術效果說明

## 概述

FlurPaint 提供兩種主要的藝術視覺效果，可根據觀眾與感應器的距離動態調整畫面品質：

1. **動態解析度** - 距離越近，像素化效果越明顯
2. **動態 JPEG 品質** - 距離越近，壓縮失真越嚴重

這些效果象徵隱私保護與觀看距離的關係，提供獨特的互動體驗。

---

## 🖼️ 動態解析度效果

### 功能說明
- 根據觀眾距離動態調整畫面解析度
- 距離近時降低解析度（產生像素化效果）
- 距離遠時恢復原始解析度
- 使用 Canvas 縮放技術即時處理

### 設定參數

| 參數 | 說明 | 預設值 | 範圍 |
|------|------|--------|------|
| `enable_dynamic_resolution` | 啟用動態解析度 | `true` | true/false |
| `min_resolution_scale` | 最低解析度比例 | `0.3` | 0.1 - 1.0 |
| `max_resolution_scale` | 最高解析度比例 | `1.0` | 0.1 - 1.0 |

### 藝術效果
- **0.3 (30%)**: 強烈像素化，馬賽克效果明顯
- **0.5 (50%)**: 中等像素化，保留基本輪廓
- **0.8 (80%)**: 輕微模糊，細節清晰
- **1.0 (100%)**: 原始解析度，完全清晰

### 使用建議
```json
{
  "flur_streaming": {
    "enable_dynamic_resolution": true,
    "min_resolution_scale": 0.3,  // 近距離: 30% 解析度
    "max_resolution_scale": 1.0   // 遠距離: 100% 解析度
  }
}
```

---

## 📸 動態 JPEG 品質效果

### 功能說明
- 根據觀眾距離動態調整 JPEG 壓縮品質
- 距離近時使用低品質壓縮（產生明顯失真）
- 距離遠時使用高品質壓縮
- 透過 Canvas `toDataURL()` 即時壓縮處理

### 設定參數

| 參數 | 說明 | 預設值 | 範圍 |
|------|------|--------|------|
| `enable_dynamic_quality` | 啟用動態 JPEG 品質 | `false` | true/false |
| `jpeg_quality` | 固定品質值 | `70` | 10 - 100 |
| `min_jpeg_quality` | 最低 JPEG 品質 | `30` | 1 - 100 |
| `max_jpeg_quality` | 最高 JPEG 品質 | `85` | 1 - 100 |

### 藝術效果
- **10-30**: 嚴重失真，色塊明顯，適合極端藝術效果
- **30-50**: 明顯壓縮痕跡，細節模糊
- **50-70**: 輕微失真，整體可接受
- **70-100**: 高品質，幾乎無失真

### 使用建議
```json
{
  "flur_streaming": {
    "enable_dynamic_quality": true,
    "min_jpeg_quality": 30,  // 近距離: 低品質壓縮
    "max_jpeg_quality": 85   // 遠距離: 高品質
  }
}
```

### ⚠️ 效能注意事項
- 動態 JPEG 品質會增加 CPU 負載（需要壓縮/解壓縮）
- 建議優先使用**動態解析度**，效能更好且效果更明顯
- 可同時啟用兩者，但會進一步增加負載

---

## 🎭 複合效果組合

### 組合 1: 極簡像素化（推薦）
```json
{
  "flur_streaming": {
    "enable_dynamic_resolution": true,
    "min_resolution_scale": 0.2,
    "max_resolution_scale": 1.0,
    "enable_dynamic_quality": false
  },
  "canvas_filter": {
    "enabled": false
  }
}
```
**效果**: 純粹的像素化效果，效能最佳

---

### 組合 2: 雙重劣化（藝術性強）
```json
{
  "flur_streaming": {
    "enable_dynamic_resolution": true,
    "min_resolution_scale": 0.3,
    "max_resolution_scale": 1.0,
    "enable_dynamic_quality": true,
    "min_jpeg_quality": 20,
    "max_jpeg_quality": 80
  },
  "canvas_filter": {
    "enabled": false
  }
}
```
**效果**: 解析度降低 + JPEG 壓縮，雙重失真效果

---

### 組合 3: 完整藝術組合（最複雜）
```json
{
  "flur_streaming": {
    "enable_dynamic_resolution": true,
    "min_resolution_scale": 0.4,
    "max_resolution_scale": 1.0,
    "enable_dynamic_quality": true,
    "min_jpeg_quality": 30,
    "max_jpeg_quality": 85
  },
  "canvas_filter": {
    "enabled": true,
    "max_blur_radius": 5,
    "noise_enabled": true,
    "max_noise_intensity": 0.08
  },
  "blur_overlay": {
    "enabled": true,
    "max_blur_radius": 8,
    "max_opacity": 0.3
  }
}
```
**效果**: 解析度 + 壓縮 + 模糊濾鏡 + 噪點 + 模糊圖層

---

## 🎯 效能與品質平衡

### 效能排序（由快到慢）
1. ✅ **動態解析度** (Canvas 縮放，GPU 加速)
2. ⚠️ **Canvas Filter 模糊** (原生濾鏡，GPU 加速)
3. ⚠️ **動態 JPEG 品質** (需要編碼/解碼，CPU 密集)
4. ❌ **模糊圖層** (多次繪製，CPU 密集)

### 建議配置

#### 高效能模式（60fps）
```json
{
  "enable_dynamic_resolution": true,
  "enable_dynamic_quality": false,
  "canvas_filter": { "enabled": false },
  "blur_overlay": { "enabled": false }
}
```

#### 平衡模式（30fps）
```json
{
  "enable_dynamic_resolution": true,
  "enable_dynamic_quality": false,
  "canvas_filter": { "enabled": true },
  "blur_overlay": { "enabled": false }
}
```

#### 藝術模式（15-30fps）
```json
{
  "enable_dynamic_resolution": true,
  "enable_dynamic_quality": true,
  "canvas_filter": { "enabled": true },
  "blur_overlay": { "enabled": true }
}
```

---

## 🔧 前端實現技術

### 動態解析度實現
```javascript
// 1. 建立低解析度臨時 Canvas
const tempCanvas = document.createElement('canvas');
tempCanvas.width = Math.floor(originalWidth * resolutionScale);
tempCanvas.height = Math.floor(originalHeight * resolutionScale);

// 2. 繪製影像到臨時 Canvas（降低解析度）
const tempCtx = tempCanvas.getContext('2d');
tempCtx.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);

// 3. 放大回原始尺寸（產生像素化效果）
ctx.imageSmoothingEnabled = false;  // 關閉抗鋸齒
ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
```

### 動態 JPEG 品質實現
```javascript
// 1. 將 Canvas 內容轉為 JPEG Data URL（壓縮）
const quality = 0.3;  // 30% 品質
const dataUrl = canvas.toDataURL('image/jpeg', quality);

// 2. 載入壓縮後的圖片（解壓縮）
const img = new Image();
img.onload = () => {
    ctx.drawImage(img, 0, 0);  // 繪製回 Canvas
};
img.src = dataUrl;
```

---

## 📊 效能測試數據

### MacBook Pro (M2)
- **動態解析度 (0.3 scale)**: 60 FPS ✅
- **動態解析度 + Canvas Filter**: 60 FPS ✅
- **動態解析度 + JPEG 品質**: 30-45 FPS ⚠️
- **完整組合**: 15-25 FPS ❌

### Windows PC (Intel i7)
- **動態解析度 (0.3 scale)**: 60 FPS ✅
- **動態解析度 + Canvas Filter**: 45-60 FPS ⚠️
- **動態解析度 + JPEG 品質**: 20-30 FPS ⚠️
- **完整組合**: 10-20 FPS ❌

---

## 🎨 藝術詮釋建議

### 隱私距離概念
- **近距離 (< 70cm)**: 強烈劣化，象徵過度接近侵犯隱私
- **中距離 (70-120cm)**: 適度模糊，維持舒適觀賞距離
- **遠距離 (> 120cm)**: 清晰呈現，象徵尊重個人空間

### 互動體驗設計
1. 吸引觀眾靠近（好奇心驅使）
2. 近距離時畫面劣化（挫折感）
3. 後退時畫面恢復（頓悟）
4. 理解最佳觀看距離（互動完成）

---

## 🛠️ 除錯技巧

### 開啟 Debug 模式
在 `flur_admin.html` 中啟用「顯示偵錯資訊」，即可看到：
- 當前解析度比例
- JPEG 品質值
- FPS 數據
- 距離感應數值

### 測試命令
```bash
# 開啟後台管理
open http://localhost:5000/flur_admin.html

# 開啟展示頁面
open http://localhost:5000/flur.html
```

### 常見問題
**Q: 為什麼啟用動態 JPEG 品質後 FPS 下降？**  
A: JPEG 壓縮/解壓縮是 CPU 密集操作，建議降低 `max_fps` 或只使用動態解析度。

**Q: 像素化效果不明顯？**  
A: 降低 `min_resolution_scale` 至 0.2-0.3，並確認 `enable_dynamic_resolution` 為 true。

**Q: 可以只用固定品質不要動態調整嗎？**  
A: 可以，將 `enable_dynamic_quality` 設為 false，並設定固定 `jpeg_quality` 值。

---

## 📚 相關文件

- [FlurPaint 使用指南](./FlurPaint使用指南.md)
- [FPS 優化說明](./FPS優化說明.md)
- [Canvas Filter 功能說明](./模糊圖層功能說明.md)
