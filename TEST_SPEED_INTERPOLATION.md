# 速度插值功能測試指南

## 測試環境

- **後端**: FastAPI (port 8000)
- **前端**: 靜態檔案伺服器
- **配置檔案**: `backend/configs/project_config.json`

## 測試步驟

### 1. 啟動後端服務

```powershell
cd backend
python main.py
```

確認看到:
```
✅ 服務啟動完成!
📍 播放頁面: http://localhost:8000/player.html
📍 後台管理介面: http://localhost:8000/admin.html
📍 API 文件: http://localhost:8000/docs
```

### 2. 測試配置讀取

#### 方式 1: 使用瀏覽器開發者工具

1. 開啟 `http://localhost:8000/index.html`
2. 按 F12 開啟開發者工具
3. 切換到 Console 標籤
4. 檢查是否看到載入訊息:
   ```
   ✅ 速度插值配置已載入: {enabled: true, points: Array(3)}
   ```

#### 方式 2: 直接呼叫 API

開啟瀏覽器訪問:
```
http://localhost:8000/api/admin/config
```

應該看到包含 `speedInterpolation` 的 JSON 回應:
```json
{
  "status": "success",
  "message": "成功取得專案配置",
  "data": {
    "speedInterpolation": {
      "enabled": true,
      "points": [
        {"distance": 130, "speed": 8.0},
        {"distance": 150, "speed": 3.0},
        {"distance": 170, "speed": 0.5}
      ]
    },
    ...
  }
}
```

### 3. 測試後台設定介面

1. 開啟 `http://localhost:8000/index.html`
2. 捲動到「📈 速度插值設定」區塊
3. 應該看到預設值:
   - 點 1: 130cm → 8.0x
   - 點 2: 150cm → 3.0x
   - 點 3: 170cm → 0.5x
   - ☑ 啟用三點插值模式

### 4. 測試設定儲存

1. 修改任一數值,例如:
   - 點 1: 120cm → 10.0x
   - 點 2: 160cm → 5.0x
   - 點 3: 200cm → 1.0x

2. 點擊「💾 儲存插值設定」

3. 應該看到成功訊息:
   ```
   ✅ 速度插值配置已儲存
   ✅ 已套用: P1(120cm,10.0x) P2(160cm,5.0x) P3(200cm,1.0x)
   ```

4. 檢查 Console 應該看到:
   ```
   📤 準備儲存配置: {...}
   📥 伺服器回應: {status: "success", ...}
   ```

### 5. 測試配置持久化

1. 重新整理頁面 (F5)
2. 檢查「速度插值設定」區塊
3. 數值應該保持修改後的狀態
4. 或者檢查配置檔案:
   ```powershell
   cat backend\configs\project_config.json
   ```

### 6. 測試播放器讀取配置

1. 開啟 `http://localhost:8000/player.html`
2. 按 F12 開啟 Console
3. 應該看到:
   ```
   📥 正在載入配置...
   ✅ 配置已載入: {...}
   📈 速度插值配置: {...}
   ✓ 三點插值模式已啟用
     點 1: {distance: 120, speed: 10}
     點 2: {distance: 160, speed: 5}
     點 3: {distance: 200, speed: 1}
   ```

### 7. 測試即時速度切換

1. 確保攝影機已連接並啟動偵測
2. 按 `Ctrl+Shift+D` 開啟除錯模式
3. 觀察「偵測距離」和「播放速度」
4. 在不同距離應該看到對應速度:
   - 距離 ≤ 120cm → 速度 10.0x
   - 距離 140cm (120-160之間) → 速度約 7.5x (線性插值)
   - 距離 160cm → 速度 5.0x
   - 距離 180cm (160-200之間) → 速度約 3.0x (線性插值)
   - 距離 ≥ 200cm → 速度 1.0x

5. Console 應該顯示插值計算日誌:
   ```
   🎯 三點插值 | 距離: 140.0cm | P1(120cm,10x) P2(160cm,5x) P3(200cm,1x) → 速度: 7.50x
   ⚡ 即時切換速度: 7.50x
   ```

## 預期結果

### ✅ 成功標準

- [ ] 後台可以正確載入預設的三點插值設定
- [ ] 修改設定後可以成功儲存到 `project_config.json`
- [ ] 重新整理頁面後設定保持不變
- [ ] 播放器可以正確讀取配置
- [ ] 距離變化時速度即時切換 (無延遲)
- [ ] 兩點之間正確進行線性插值

### ❌ 常見問題

#### 問題 1: 後台無法載入設定
**症狀**: Console 顯示 `❌ 載入速度插值配置失敗`
**解決**: 
1. 檢查 API 端點是否正常: `http://localhost:8000/api/admin/config`
2. 檢查 `project_config.json` 是否存在且格式正確
3. 檢查後端是否正常啟動

#### 問題 2: 儲存後沒有反應
**症狀**: 點擊儲存按鈕後沒有成功訊息
**解決**:
1. 開啟 Console 查看錯誤訊息
2. 檢查網路請求 (Network 標籤)
3. 確認距離點由小到大排列

#### 問題 3: 播放器無法讀取配置
**症狀**: 播放器 Console 沒有顯示插值配置
**解決**:
1. 確認 `apiClient.getConfig()` 正常運作
2. 檢查 `project_config.json` 中是否有 `speedInterpolation` 區塊
3. 確認前端程式碼已更新

#### 問題 4: 速度沒有即時切換
**症狀**: 距離變化時速度有延遲
**解決**:
1. 確認 `transitionTime` 設定為 0
2. 檢查 `applySpeedInstantly()` 函式是否被呼叫
3. 確認使用的是三點插值模式而非傳統模式

## 測試清單

```
□ 後端服務啟動成功
□ API 端點回應正常
□ 後台介面載入預設設定
□ 修改設定並儲存成功
□ 設定持久化驗證通過
□ 播放器正確讀取配置
□ 距離 ≤ P1 時使用 P1 速度
□ 距離在 P1-P2 之間正確插值
□ 距離在 P2-P3 之間正確插值
□ 距離 ≥ P3 時使用 P3 速度
□ 速度切換無延遲
□ Console 日誌正確顯示
```

## 進階測試

### 邊界條件測試

1. **極端距離值**
   - 測試距離 = 0 (應該觸發無人臉處理)
   - 測試距離 < P1 (應該使用 P1 速度)
   - 測試距離 > P3 (應該使用 P3 速度)

2. **極端速度值**
   - 設定 speed = 0.1 (最小速度)
   - 設定 speed = 20.0 (最大速度)

3. **停用插值模式**
   - 取消勾選「啟用三點插值模式」
   - 儲存設定
   - 驗證是否回退到傳統雙點模式

### 壓力測試

1. 快速連續修改距離
2. 觀察速度切換是否平滑
3. 確認沒有記憶體洩漏或效能問題

## 完成確認

完成所有測試後,確認:

1. ✅ 後台可以設定三個距離點及速度
2. ✅ 設定可以正確儲存到 `project_config.json`
3. ✅ 前端可以正確讀取並使用設定
4. ✅ 速度根據距離即時切換 (無延遲)
5. ✅ 兩點之間使用線性插值

**測試完成日期**: ____________

**測試人員**: ____________

**備註**: ____________
