# ğŸš€ FPS å„ªåŒ–èªªæ˜

## ğŸ“‹ å„ªåŒ–å…§å®¹ç¸½è¦½

### 1ï¸âƒ£ å¾Œç«¯å½±åƒå‚³è¼¸å„ªåŒ–

#### å‹•æ…‹è§£æåº¦èª¿æ•´ (`detector.py`)
- **åŸç†**: å¾Œç«¯æ ¹æ“šåµæ¸¬è·é›¢å‹•æ…‹ç¸®æ”¾å½±åƒå¾Œå†å‚³é€
- **æ•ˆæœ**: è¿‘è·é›¢æ™‚å‚³é€ 320x180ï¼Œé è·é›¢æ™‚å‚³é€ 1920x1080
- **å„ªå‹¢**: å¤§å¹…æ¸›å°‘ç¶²è·¯å‚³è¼¸é‡ï¼ˆæœ€å¤šå¯æ¸›å°‘ 90%ï¼‰

#### å¯é…ç½® JPEG å“è³ª
- **é è¨­å€¼**: 70ï¼ˆåŸç‚º 85ï¼‰
- **èª¿æ•´ç¯„åœ**: 10-100
- **ä½ç½®**: `project_config.json` â†’ `flur_streaming.jpeg_quality`

### 2ï¸âƒ£ å‰ç«¯ Canvas æ¸²æŸ“å„ªåŒ–

#### é—œéµåŸç†
```javascript
// Canvas å…§éƒ¨è§£æåº¦ = å¾Œç«¯å‚³ä¾†çš„ä½è§£æåº¦
canvas.width = 320;   // ä½è§£æåº¦
canvas.height = 180;

// Canvas CSS å°ºå¯¸ = å…¨è¢å¹•
canvas.style.width = "100vw";
canvas.style.height = "100vh";

// çµæœï¼šä½è§£æåº¦å…§å®¹è¢«æ‹‰ä¼¸åˆ°å…¨è¢å¹• â†’ ç”¢ç”Ÿæ¨¡ç³Š/åƒç´ åŒ–æ•ˆæœ
```

#### æ•ˆèƒ½å„ªå‹¢
- âœ… **GPU åŠ é€Ÿ**: ç€è¦½å™¨è‡ªå‹•ä½¿ç”¨ GPU è™•ç† Canvas ç¸®æ”¾
- âœ… **é›¶ CPU è² æ“”**: ä¸éœ€è¦ JavaScript é€²è¡Œå½±åƒè™•ç†
- âœ… **å³æ™‚éŸ¿æ‡‰**: è§£æåº¦è®ŠåŒ–ç«‹å³åæ˜ åœ¨ç•«é¢ä¸Š

### 3ï¸âƒ£ æ–°å¢å¾Œå°åƒæ•¸è¨­å®š

#### ä¸²æµæ•ˆèƒ½è¨­å®šå€å¡Š
- **JPEG å£“ç¸®å“è³ª** (10-100)
  - è¶Šä½ï¼šæª”æ¡ˆè¶Šå°ï¼ŒFPS è¶Šé«˜ï¼Œç•«è³ªè¶Šå·®
  - å»ºè­°å€¼ï¼š50-70
  
- **æœ€å¤§ FPS** (10-60)
  - é™åˆ¶ä¸²æµå¹€ç‡ä¸Šé™
  - å»ºè­°å€¼ï¼š30
  
- **è·³å¹€æ•¸** (1-10)
  - æ¯éš”å¤šå°‘å¹€å‚³é€ä¸€æ¬¡
  - 1 = ä¸è·³å¹€ï¼ˆå»ºè­°ï¼‰
  
- **å•Ÿç”¨å‹•æ…‹è§£æåº¦**
  - é–‹å•Ÿï¼šæ ¹æ“šè·é›¢å‹•æ…‹èª¿æ•´ï¼ˆæ¨è–¦ï¼‰
  - é—œé–‰ï¼šå›ºå®šä½¿ç”¨æœ€é«˜è§£æåº¦

## ğŸ“Š æ•ˆèƒ½å°æ¯”

| é …ç›® | å„ªåŒ–å‰ | å„ªåŒ–å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| **å½±åƒå¤§å°** | 1920x1080 (å›ºå®š) | 320x180 ~ 1920x1080 | å‹•æ…‹ |
| **å‚³è¼¸é‡ (è¿‘è·é›¢)** | ~150 KB/å¹€ | ~10 KB/å¹€ | â†“ 93% |
| **å‚³è¼¸é‡ (é è·é›¢)** | ~150 KB/å¹€ | ~80 KB/å¹€ | â†“ 47% |
| **JPEG å“è³ª** | 85 | 70 (å¯èª¿) | â†“ ~30% |
| **é æœŸ FPS** | 5-9 FPS | **20-30 FPS** | â†‘ 3-5 å€ |

## ğŸ¯ é‹ä½œæµç¨‹

```
ã€å„ªåŒ–å¾Œçš„å®Œæ•´æµç¨‹ã€‘

æ”å½±æ©Ÿ 1920x1080
    â†“
YOLO åµæ¸¬ â†’ è·é›¢: 80cm
    â†“
è¨ˆç®—ç›®æ¨™è§£æåº¦ â†’ 640x360
    â†“
OpenCV ç¸®æ”¾å½±åƒ (cv2.resize)
    â†“
JPEG å£“ç¸® (å“è³ª 70)
    â†“
Base64 ç·¨ç¢¼
    â†“
WebSocket å‚³è¼¸ (~30 KB)
    â†“
å‰ç«¯è§£ç¢¼å½±åƒ
    â†“
Canvas å…§éƒ¨è§£æåº¦è¨­ç‚º 640x360
    â†“
CSS æ‹‰ä¼¸åˆ°å…¨è¢å¹• (GPU åŠ é€Ÿ)
    â†“
ä½¿ç”¨è€…çœ‹åˆ°æ¨¡ç³Šçš„å…¨è¢å¹•ç•«é¢
```

## âš™ï¸ é…ç½®æª”æ¡ˆçµæ§‹

### `project_config.json`

```json
{
  "blur_control": {
    "min_resolution_width": 320,    // æœ€å°è§£æåº¦
    "max_resolution_width": 1920    // æœ€å¤§è§£æåº¦
  },
  "distance_mapping": {
    "min_distance": 50,    // æœ€è¿‘è·é›¢ (cm)
    "max_distance": 100    // æœ€é è·é›¢ (cm)
  },
  "flur_streaming": {
    "jpeg_quality": 70,               // JPEG å“è³ª
    "enable_dynamic_resolution": true, // å‹•æ…‹è§£æåº¦é–‹é—œ
    "frame_skip": 1,                  // è·³å¹€æ•¸
    "max_fps": 30                     // æœ€å¤§ FPS
  }
}
```

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. å•Ÿå‹•å¾Œç«¯
```bash
cd backend
python3.11 main.py
```

### 2. é–‹å•Ÿå¾Œå°è¨­å®š
ç€è¦½å™¨è¨ªå•: http://localhost:8000/flur-admin

### 3. èª¿æ•´åƒæ•¸æ¸¬è©¦
- **ä½ FPS è¨­å®š**: JPEG å“è³ª = 90, æœ€å°è§£æåº¦ = 640
- **é«˜ FPS è¨­å®š**: JPEG å“è³ª = 50, æœ€å°è§£æåº¦ = 160

### 4. é–‹å•Ÿå±•ç¤ºé é¢
ç€è¦½å™¨è¨ªå•: http://localhost:8000/flur

### 5. æ¸¬è©¦äº’å‹•
- èµ°è¿‘æ”å½±æ©Ÿ â†’ ç•«é¢æ‡‰è©²è®Šæ¨¡ç³Šï¼ˆè§£æåº¦é™ä½ï¼‰
- èµ°é æ”å½±æ©Ÿ â†’ ç•«é¢æ‡‰è©²è®Šæ¸…æ™°ï¼ˆè§£æåº¦æé«˜ï¼‰
- æŒ‰ `Ctrl+Shift+D` â†’ é¡¯ç¤ºé™¤éŒ¯è³‡è¨Šï¼ˆæŸ¥çœ‹å¯¦éš›è§£æåº¦å’Œ FPSï¼‰

## ğŸ” é™¤éŒ¯è³‡è¨Šè§£è®€

æŒ‰ `Ctrl+Shift+D` é–‹å•Ÿé™¤éŒ¯æ¨¡å¼ï¼Œæœƒé¡¯ç¤ºï¼š

```
é€£ç·šç‹€æ…‹: å·²é€£ç·š
åµæ¸¬è·é›¢: 85.3 cm
åµæ¸¬äººæ•¸: 1
ç›®æ¨™è§£æåº¦: 640 x 360      â† å¾Œç«¯è¨ˆç®—çš„ç›®æ¨™è§£æåº¦
ç•¶å‰è§£æåº¦: 640 x 360      â† Canvas å¯¦éš›ä½¿ç”¨çš„è§£æåº¦
FPS: 28                     â† å¯¦éš›å¹€ç‡
```

**é—œéµæŒ‡æ¨™**:
- `ç›®æ¨™è§£æåº¦` = `ç•¶å‰è§£æåº¦` â†’ æ­£å¸¸å·¥ä½œ
- `FPS` > 20 â†’ å„ªåŒ–æˆåŠŸ
- è·é›¢è®ŠåŒ–æ™‚ï¼Œè§£æåº¦æ‡‰è©²è·Ÿè‘—è®ŠåŒ–

## ğŸ’¡ é€²ä¸€æ­¥å„ªåŒ–å»ºè­°

### å¦‚æœ FPS é‚„æ˜¯ä¸å¤ é«˜

1. **é™ä½ JPEG å“è³ª**
   ```json
   "jpeg_quality": 50  // é™åˆ° 50
   ```

2. **é™ä½æœ€å¤§è§£æåº¦**
   ```json
   "max_resolution_width": 1280  // å¾ 1920 é™åˆ° 1280
   ```

3. **ç¸®å°è·é›¢ç¯„åœ**
   ```json
   "max_distance": 150  // å¾ 500 é™åˆ° 150
   ```
   â†’ è§£æåº¦ä¸æœƒå‡åˆ°å¤ªé«˜

4. **å•Ÿç”¨è·³å¹€**
   ```json
   "frame_skip": 2  // æ¯éš”ä¸€å¹€å‚³é€
   ```

### å¦‚æœç•«è³ªä¸å¤ å¥½

1. **æé«˜ JPEG å“è³ª**
   ```json
   "jpeg_quality": 80
   ```

2. **æé«˜æœ€å°è§£æåº¦**
   ```json
   "min_resolution_width": 480
   ```

## ğŸ¨ è—è¡“æ•ˆæœèª¿æ•´

### æ›´æ˜é¡¯çš„æ¨¡ç³Šæ•ˆæœ
```json
{
  "blur_control": {
    "min_resolution_width": 160,   // è¶…ä½è§£æåº¦
    "max_resolution_width": 1920
  },
  "distance_mapping": {
    "min_distance": 30,   // æ›´è¿‘æ‰é–‹å§‹æ¨¡ç³Š
    "max_distance": 200   // æ›´é æ‰å®Œå…¨æ¸…æ™°
  }
}
```

### æ›´ç´°ç·»çš„éæ¸¡
```json
{
  "blur_control": {
    "min_resolution_width": 480,   // ä¸è¦å¤ªæ¨¡ç³Š
    "max_resolution_width": 1280   // ä¸è¦å¤ªæ¸…æ™°
  },
  "distance_mapping": {
    "min_distance": 50,
    "max_distance": 150,  // è¼ƒçŸ­çš„è·é›¢ç¯„åœ
    "easing_function": "ease-in-out"  // å¹³æ»‘éæ¸¡
  }
}
```

## ğŸ› å¸¸è¦‹å•é¡Œæ’é™¤

### Q1: FPS é‚„æ˜¯å¾ˆä½ (< 10)
- æª¢æŸ¥ç¶²è·¯é€£ç·šå“è³ª
- é™ä½ JPEG å“è³ªåˆ° 50
- é™ä½æœ€å¤§è§£æåº¦åˆ° 1280
- ç¢ºèª `enable_dynamic_resolution` ç‚º `true`

### Q2: ç•«é¢æ²’æœ‰æ¨¡ç³Šæ•ˆæœ
- æª¢æŸ¥é™¤éŒ¯è³‡è¨Šä¸­çš„ã€Œç•¶å‰è§£æåº¦ã€
- ç¢ºèªè·é›¢åµæ¸¬æ­£å¸¸å·¥ä½œ
- æª¢æŸ¥ `image-rendering: pixelated` CSS æ˜¯å¦ç”Ÿæ•ˆ

### Q3: è§£æåº¦ä¸æœƒè®ŠåŒ–
- ç¢ºèªå¾Œç«¯é…ç½®å·²å„²å­˜
- é‡æ–°å•Ÿå‹•å¾Œç«¯æœå‹™
- æª¢æŸ¥ WebSocket é€£ç·šæ˜¯å¦æ­£å¸¸

### Q4: ç•«é¢æ¯”ä¾‹ä¸å°
- æ‡‰è©²æ˜¯ 16:9 æ¯”ä¾‹
- æª¢æŸ¥ Canvas çš„ `object-fit: contain`
- ç¢ºèªå¾Œç«¯è¨ˆç®—çš„é«˜åº¦ = å¯¬åº¦ Ã— 9 / 16

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æŸ¥çœ‹ï¼š
- `/docs/å°ˆæ¡ˆçµæ§‹.md` - å°ˆæ¡ˆçµæ§‹èªªæ˜
- `/docs/å¿«é€Ÿå•Ÿå‹•.md` - å•Ÿå‹•æŒ‡å—
- http://localhost:8000/docs - API æ–‡ä»¶

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2025-11-09  
**å„ªåŒ–é‡é»**: FPS æå‡ 3-5 å€ + å¾Œå°åƒæ•¸è¨­å®š
