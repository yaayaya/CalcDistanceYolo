<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlurPaint å¾Œå°ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* æ¨™é¡Œå€ */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        /* ä¸»å…§å®¹å€ */
        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        /* è¡¨å–®æ¨£å¼ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group small {
            display: block;
            color: #64748b;
            margin-top: 5px;
            font-size: 13px;
        }

        .form-group .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .form-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: #fff;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #64748b;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: #fff;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f59e0b;
            color: #fff;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .btn-link {
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
        }

        .btn-link:hover {
            background: #667eea;
            color: #fff;
        }

        /* è¨Šæ¯æç¤º */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* è£ç½®é¸æ“‡èªªæ˜ */
        .device-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .device-info h3 {
            font-size: 16px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .device-info p {
            color: #64748b;
            font-size: 14px;
            line-height: 1.6;
            margin: 5px 0;
        }

        /* é€£çµæ¨£å¼ */
        .quick-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .quick-links a {
            padding: 10px 20px;
            background: #f1f5f9;
            color: #667eea;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .quick-links a:hover {
            background: #667eea;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ FlurPaint äº’å‹•è—è¡“è£ç½®</h1>
            <p class="subtitle">å¾Œå°ç®¡ç†èˆ‡åƒæ•¸è¨­å®š</p>
        </header>

        <div class="content">
            <!-- è¦–è¨Šæ¨¡ç³Šæ§åˆ¶åƒæ•¸ -->
            <section class="section">
                <h2>ğŸ“º è¦–è¨Šæ¨¡ç³Šæ§åˆ¶åƒæ•¸</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="min-resolution">æœ€å°è§£æåº¦å¯¬åº¦ (px)</label>
                        <input type="number" id="min-resolution" min="160" max="1920" step="10">
                        <small>æœ€è¿‘è·é›¢æ™‚çš„è§£æåº¦ (é«˜åº¦è‡ªå‹•è¨ˆç®—ç‚º 16:9)</small>
                    </div>

                    <div class="form-group">
                        <label for="max-resolution">æœ€å¤§è§£æåº¦å¯¬åº¦ (px)</label>
                        <input type="number" id="max-resolution" min="320" max="1920" step="10">
                        <small>æœ€é è·é›¢æ™‚çš„è§£æåº¦ (é«˜åº¦è‡ªå‹•è¨ˆç®—ç‚º 16:9)</small>
                    </div>

                    <div class="form-group">
                        <label for="acceleration-time">åŠ é€ŸéŸ¿æ‡‰æ™‚é–“ (ms)</label>
                        <input type="number" id="acceleration-time" min="100" max="5000" step="100">
                        <small>è§£æåº¦é™ä½ (æ¨¡ç³ŠåŒ–) çš„éæ¸¡æ™‚é–“</small>
                    </div>

                    <div class="form-group">
                        <label for="deceleration-time">æ¸›é€ŸéŸ¿æ‡‰æ™‚é–“ (ms)</label>
                        <input type="number" id="deceleration-time" min="100" max="5000" step="100">
                        <small>è§£æåº¦æé«˜ (æ¸…æ™°åŒ–) çš„éæ¸¡æ™‚é–“</small>
                    </div>

                    <div class="form-group">
                        <label for="movement-threshold">ç§»å‹•é–¾å€¼ (cm)</label>
                        <input type="number" id="movement-threshold" min="1" max="50" step="1">
                        <small>è§¸ç™¼è§£æåº¦è®ŠåŒ–çš„æœ€å°è·é›¢è®ŠåŒ–é‡</small>
                    </div>

                    <div class="form-group">
                        <label for="activation-delay">å•Ÿå‹•å»¶é² (ms)</label>
                        <input type="number" id="activation-delay" min="0" max="2000" step="50">
                        <small>åµæ¸¬åˆ°äººé«”å¾Œå»¶é²å•Ÿå‹•çš„æ™‚é–“</small>
                    </div>

                    <div class="form-group">
                        <label for="deactivation-delay">åœæ­¢å»¶é² (ms)</label>
                        <input type="number" id="deactivation-delay" min="0" max="2000" step="50">
                        <small>äººé«”é›¢é–‹å¾Œå»¶é²åœæ­¢çš„æ™‚é–“</small>
                    </div>

                    <div class="form-group">
                        <label for="sample-rate">å–æ¨£é »ç‡ (fps)</label>
                        <input type="number" id="sample-rate" min="10" max="60" step="5">
                        <small>è·é›¢è³‡æ–™å–æ¨£èˆ‡æ›´æ–°é »ç‡</small>
                    </div>
                </div>
            </section>

            <!-- è·é›¢æ˜ å°„è¨­å®š -->
            <section class="section">
                <h2>ğŸ“ è·é›¢æ˜ å°„è¨­å®š</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="min-distance">æœ€å°è·é›¢ (cm)</label>
                        <input type="number" id="min-distance" min="10" max="200" step="5">
                        <small>å°æ‡‰æœ€ä½è§£æåº¦çš„è·é›¢</small>
                    </div>

                    <div class="form-group">
                        <label for="max-distance">æœ€å¤§è·é›¢ (cm)</label>
                        <input type="number" id="max-distance" min="200" max="1000" step="10">
                        <small>å°æ‡‰æœ€é«˜è§£æåº¦çš„è·é›¢</small>
                    </div>

                    <div class="form-group">
                        <label for="easing-function">ç·©å‹•å‡½æ•¸</label>
                        <select id="easing-function">
                            <option value="linear">ç·šæ€§ (Linear)</option>
                            <option value="ease-in">ç·©å…¥ (Ease In)</option>
                            <option value="ease-out">ç·©å‡º (Ease Out)</option>
                            <option value="ease-in-out">ç·©å…¥ç·©å‡º (Ease In-Out)</option>
                        </select>
                        <small>è·é›¢åˆ°è§£æåº¦çš„æ˜ å°„æ›²ç·š</small>
                    </div>
                </div>
            </section>

            <!-- YOLO è¨­å‚™é¸æ“‡ -->
            <section class="section">
                <h2>âš™ï¸ YOLO æ¨è«–è¨­å‚™</h2>
                <div class="form-group">
                    <label for="yolo-device">æ¨è«–è¨­å‚™</label>
                    <select id="yolo-device">
                        <option value="cpu">CPU (ç›¸å®¹æ€§æœ€ä½³)</option>
                        <option value="cuda">NVIDIA GPU (CUDA)</option>
                        <option value="mps">Apple Silicon GPU (M1/M2/M3)</option>
                    </select>
                    <small id="device-description">ä½¿ç”¨ CPU é€²è¡Œæ¨è«– (ç›¸å®¹æ€§æœ€ä½³)</small>
                </div>

                <div class="device-info">
                    <h3>ğŸ’¡ è¨­å‚™é¸æ“‡èªªæ˜</h3>
                    <p><strong>CPU:</strong> é©ç”¨æ–¼æ‰€æœ‰é›»è…¦,é€Ÿåº¦è¼ƒæ…¢ä½†ç©©å®šå¯é </p>
                    <p><strong>NVIDIA GPU (CUDA):</strong> éœ€è¦ NVIDIA é¡¯ç¤ºå¡ä¸”å·²å®‰è£ CUDA,é€Ÿåº¦æœ€å¿«</p>
                    <p><strong>Apple Silicon GPU (MPS):</strong> é©ç”¨æ–¼ M1/M2/M3 æ™¶ç‰‡çš„ Mac,éœ€ PyTorch 2.0+</p>
                </div>
            </section>

            <!-- é¡¯ç¤ºæ¨¡å¼è¨­å®š -->
            <section class="section">
                <h2>ğŸ–¥ï¸ é¡¯ç¤ºæ¨¡å¼</h2>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-mode">
                        <span>é™¤éŒ¯æ¨¡å¼ (é¡¯ç¤ºå³æ™‚ç‹€æ…‹è³‡è¨Š)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="exhibition-mode">
                        <span>å±•è¦½æ¨¡å¼ (å…¨è¢å¹•ç°¡æ½”é¡¯ç¤º)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-fps">
                        <span>é¡¯ç¤º FPS</span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-distance">
                        <span>é¡¯ç¤ºè·é›¢è³‡è¨Š</span>
                    </label>
                </div>
            </section>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="btn-group">
                <button onclick="loadConfig()" class="btn btn-secondary">ğŸ”„ é‡æ–°è¼‰å…¥è¨­å®š</button>
                <button onclick="saveConfig()" class="btn btn-primary">ğŸ’¾ å„²å­˜è¨­å®š</button>
                <button onclick="resetConfig()" class="btn btn-warning">â†©ï¸ é‡ç½®ç‚ºé è¨­å€¼</button>
                <a href="/flur.html" target="_blank" class="btn btn-link">ğŸ¨ é–‹å•Ÿå±•è¦½é é¢</a>
            </div>

            <!-- å¿«é€Ÿé€£çµ -->
            <div class="quick-links">
                <a href="/admin" target="_blank">ğŸ“Š ç›£æ§å¾Œå°</a>
                <a href="/docs" target="_blank">ğŸ“– API æ–‡ä»¶</a>
            </div>

            <!-- è¨Šæ¯æç¤º -->
            <div id="message-container"></div>
        </div>
    </div>

    <script>
        let config = null;

        // é é¢è¼‰å…¥æ™‚è®€å–é…ç½®
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            bindDeviceChangeEvent();
        });

        // è¼‰å…¥é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('/api/project-config');
                const result = await response.json();

                if (result.status === 'success') {
                    config = result.data;
                    populateForm();
                    showMessage('é…ç½®å·²è¼‰å…¥', 'success');
                } else {
                    showMessage('è¼‰å…¥é…ç½®å¤±æ•—', 'error');
                }
            } catch (error) {
                console.error('è¼‰å…¥é…ç½®éŒ¯èª¤:', error);
                showMessage('è¼‰å…¥é…ç½®éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // å¡«å……è¡¨å–®
        function populateForm() {
            // è¦–è¨Šæ¨¡ç³Šæ§åˆ¶
            document.getElementById('min-resolution').value = config.blur_control.min_resolution_width;
            document.getElementById('max-resolution').value = config.blur_control.max_resolution_width;
            document.getElementById('acceleration-time').value = config.blur_control.acceleration_time;
            document.getElementById('deceleration-time').value = config.blur_control.deceleration_time;
            document.getElementById('movement-threshold').value = config.blur_control.movement_threshold;
            document.getElementById('activation-delay').value = config.blur_control.activation_delay;
            document.getElementById('deactivation-delay').value = config.blur_control.deactivation_delay;
            document.getElementById('sample-rate').value = config.blur_control.sample_rate;

            // è·é›¢æ˜ å°„
            document.getElementById('min-distance').value = config.distance_mapping.min_distance;
            document.getElementById('max-distance').value = config.distance_mapping.max_distance;
            document.getElementById('easing-function').value = config.distance_mapping.easing_function;

            // YOLO è¨­å‚™
            document.getElementById('yolo-device').value = config.yolo_device.device;
            updateDeviceDescription();

            // é¡¯ç¤ºæ¨¡å¼
            document.getElementById('debug-mode').checked = config.display.debug_mode;
            document.getElementById('exhibition-mode').checked = config.display.exhibition_mode;
            document.getElementById('show-fps').checked = config.display.show_fps;
            document.getElementById('show-distance').checked = config.display.show_distance;
        }

        // å„²å­˜é…ç½®
        async function saveConfig() {
            try {
                // æ”¶é›†è¡¨å–®æ•¸æ“š
                const updatedConfig = {
                    blur_control: {
                        min_resolution_width: parseInt(document.getElementById('min-resolution').value),
                        max_resolution_width: parseInt(document.getElementById('max-resolution').value),
                        acceleration_time: parseInt(document.getElementById('acceleration-time').value),
                        deceleration_time: parseInt(document.getElementById('deceleration-time').value),
                        movement_threshold: parseInt(document.getElementById('movement-threshold').value),
                        activation_delay: parseInt(document.getElementById('activation-delay').value),
                        deactivation_delay: parseInt(document.getElementById('deactivation-delay').value),
                        sample_rate: parseInt(document.getElementById('sample-rate').value)
                    },
                    distance_mapping: {
                        min_distance: parseInt(document.getElementById('min-distance').value),
                        max_distance: parseInt(document.getElementById('max-distance').value),
                        easing_function: document.getElementById('easing-function').value
                    },
                    yolo_device: {
                        device: document.getElementById('yolo-device').value,
                        available_devices: config.yolo_device.available_devices,
                        device_description: config.yolo_device.device_description
                    },
                    display: {
                        debug_mode: document.getElementById('debug-mode').checked,
                        exhibition_mode: document.getElementById('exhibition-mode').checked,
                        show_fps: document.getElementById('show-fps').checked,
                        show_distance: document.getElementById('show-distance').checked
                    }
                };

                const response = await fetch('/api/project-config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedConfig)
                });

                const result = await response.json();

                if (result.status === 'success') {
                    config = result.data;
                    showMessage('é…ç½®å·²å„²å­˜ä¸¦å¥—ç”¨', 'success');
                } else {
                    showMessage('å„²å­˜é…ç½®å¤±æ•—: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('å„²å­˜é…ç½®éŒ¯èª¤:', error);
                showMessage('å„²å­˜é…ç½®éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // é‡ç½®é…ç½®
        async function resetConfig() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­å®šç‚ºé è¨­å€¼å—ï¼Ÿ')) return;

            try {
                const response = await fetch('/api/project-config/reset', {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.status === 'success') {
                    config = result.data;
                    populateForm();
                    showMessage('é…ç½®å·²é‡ç½®ç‚ºé è¨­å€¼', 'success');
                } else {
                    showMessage('é‡ç½®é…ç½®å¤±æ•—: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('é‡ç½®é…ç½®éŒ¯èª¤:', error);
                showMessage('é‡ç½®é…ç½®éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type = 'info') {
            const container = document.getElementById('message-container');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;

            container.appendChild(message);

            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => {
                    container.removeChild(message);
                }, 300);
            }, 3000);
        }

        // ç¶å®šè¨­å‚™è®Šæ›´äº‹ä»¶
        function bindDeviceChangeEvent() {
            document.getElementById('yolo-device').addEventListener('change', updateDeviceDescription);
        }

        // æ›´æ–°è¨­å‚™èªªæ˜
        function updateDeviceDescription() {
            const device = document.getElementById('yolo-device').value;
            const descriptions = {
                'cpu': 'ä½¿ç”¨ CPU é€²è¡Œæ¨è«– (ç›¸å®¹æ€§æœ€ä½³)',
                'cuda': 'ä½¿ç”¨ NVIDIA GPU (éœ€è¦ CUDA æ”¯æ´)',
                'mps': 'ä½¿ç”¨ Apple Silicon GPU (M1/M2/M3 æ™¶ç‰‡)'
            };

            document.getElementById('device-description').textContent = descriptions[device] || '';
        }
    </script>
</body>
</html>
