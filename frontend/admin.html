<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DistanceVideo - å¾Œå°ç®¡ç†</title>
    <link rel="stylesheet" href="/css/admin.css">
    <script src="/cdn/vue.global.prod.js"></script>
    <script src="/cdn/axios.min.js"></script>
</head>
<body>
    <div id="admin-app">
        <header class="admin-header">
            <h1>DistanceVideo å¾Œå°ç®¡ç†</h1>
            <div class="header-actions">
                <button @click="loadConfig" class="btn btn-secondary">é‡æ–°è¼‰å…¥</button>
                <button @click="saveConfig" class="btn btn-primary">å„²å­˜è¨­å®š</button>
                <a href="/player.html" class="btn btn-link" target="_blank">é–‹å•Ÿæ’­æ”¾é é¢</a>
            </div>
        </header>

        <div class="admin-container">
            <!-- å·¦å´é¸å–® -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <a 
                        href="#" 
                        :class="{ active: currentTab === 'video' }"
                        @click.prevent="currentTab = 'video'"
                    >
                        å½±ç‰‡æ§åˆ¶åƒæ•¸
                    </a>
                    <a 
                        href="#" 
                        :class="{ active: currentTab === 'distance' }"
                        @click.prevent="currentTab = 'distance'"
                    >
                        è·é›¢åµæ¸¬æ ¡æº–
                    </a>
                    <a 
                        href="#" 
                        :class="{ active: currentTab === 'display' }"
                        @click.prevent="currentTab = 'display'"
                    >
                        é¡¯ç¤ºæ¨¡å¼æ§åˆ¶
                    </a>
                    <a 
                        href="#" 
                        :class="{ active: currentTab === 'videos' }"
                        @click.prevent="currentTab = 'videos'"
                    >
                        å½±ç‰‡ç®¡ç†
                    </a>
                </nav>
            </aside>

            <!-- ä¸»è¦å…§å®¹å€ -->
            <main class="main-content">
                <!-- å½±ç‰‡æ§åˆ¶åƒæ•¸ -->
                <section v-show="currentTab === 'video'" class="panel">
                    <h2>å½±ç‰‡æ§åˆ¶åƒæ•¸</h2>
                    
                    <div class="form-group">
                        <label>åŸºç¤æ’­æ”¾é€Ÿåº¦ (baseSpeed)</label>
                        <input 
                            type="number" 
                            v-model.number="config.video.baseSpeed" 
                            step="0.1" 
                            min="0.25" 
                            max="20.0"
                        >
                        <span class="help-text">æ­£å¸¸æ’­æ”¾å€ç‡ (0.25-20.0)</span>
                    </div>

                    <div class="form-group">
                        <label>æœ€å¤§æ’­æ”¾é€Ÿåº¦ (maxSpeed)</label>
                        <input 
                            type="number" 
                            v-model.number="config.video.maxSpeed" 
                            step="0.1" 
                            min="0.25" 
                            max="20.0"
                        >
                        <span class="help-text">ç•¶äººæœ€æ¥è¿‘æ™‚çš„æ’­æ”¾é€Ÿåº¦</span>
                    </div>

                    <div class="form-group">
                        <label>æœ€å°æ’­æ”¾é€Ÿåº¦ (minSpeed)</label>
                        <input 
                            type="number" 
                            v-model.number="config.video.minSpeed" 
                            step="0.1" 
                            min="0.25" 
                            max="20.0"
                        >
                        <span class="help-text">ç•¶äººæœ€é æ™‚çš„æ’­æ”¾é€Ÿåº¦</span>
                    </div>

                    <div class="form-group">
                        <label>é€Ÿåº¦è½‰æ›æ™‚é–“ (transitionTime)</label>
                        <input 
                            type="number" 
                            v-model.number="config.video.transitionTime" 
                            step="100"
                            min="0"
                        >
                        <span class="help-text">é€Ÿåº¦è®ŠåŒ–å¹³æ»‘éæ¸¡æ™‚é–“ (æ¯«ç§’)</span>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.video.reverseMode">
                            åå‘æ¨¡å¼ (è·é›¢è¶Šè¿‘æ’­æ”¾è¶Šæ…¢)
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.video.loop">
                            å¾ªç’°æ’­æ”¾
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.video.muted">
                            éœéŸ³
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.video.autoplay">
                            è‡ªå‹•æ’­æ”¾
                        </label>
                    </div>

                    <div class="preset-buttons">
                        <h3>å¿«é€Ÿé è¨­</h3>
                        <button 
                            v-for="preset in config.calibration.defaultPresets" 
                            :key="preset.name"
                            @click="applyPreset(preset)"
                            class="btn btn-outline"
                        >
                            {{ preset.name }}
                        </button>
                    </div>
                </section>

                <!-- è·é›¢åµæ¸¬æ ¡æº– -->
                <section v-show="currentTab === 'distance'" class="panel">
                    <h2>è·é›¢åµæ¸¬æ ¡æº–</h2>
                    
                    <!-- é€Ÿåº¦æ§åˆ¶æ¨¡å¼é¸æ“‡ -->
                    <div class="form-group" style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #0369a1;">ğŸ“ˆ é€Ÿåº¦æ§åˆ¶æ¨¡å¼</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.speedInterpolation.enabled" @change="onModeChange">
                            å•Ÿç”¨ä¸‰é»æ’å€¼æ¨¡å¼
                        </label>
                        <span class="help-text">å•Ÿç”¨å¾Œä½¿ç”¨ä¸‰å€‹è·é›¢é»é€²è¡Œç·šæ€§æ’å€¼,åœç”¨å‰‡ä½¿ç”¨å‚³çµ±é›™é»ç·šæ€§æ¨¡å¼</span>
                    </div>

                    <!-- ä¸‰é»æ’å€¼è¨­å®š -->
                    <div v-show="config.speedInterpolation.enabled" style="background: #fefce8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #ca8a04;">ğŸ¯ é€Ÿåº¦æ’å€¼é»è¨­å®š</h3>
                        <p class="help-text" style="margin-bottom: 15px;">
                            è¨­å®šä¸‰å€‹è·é›¢é»åŠå°æ‡‰æ’­æ”¾é€Ÿåº¦,ç³»çµ±æœƒæ ¹æ“šåµæ¸¬è·é›¢è‡ªå‹•é€²è¡Œç·šæ€§æ’å€¼è¨ˆç®—æ’­æ”¾é€Ÿåº¦ã€‚<br>
                            è·é›¢é»å¿…é ˆç”±å°åˆ°å¤§æ’åˆ—,ä¾‹å¦‚: 130cm (æœ€è¿‘) â†’ 150cm (ä¸­é–“) â†’ 170cm (æœ€é )
                        </p>

                        <!-- é» 1: æœ€è¿‘è·é›¢ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px;">
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #dc2626; font-weight: bold;">é» 1 - è·é›¢ (æœ€è¿‘)</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[0].distance" 
                                    step="5"
                                    min="10"
                                    max="1000"
                                >
                                <span class="help-text">æœ€è¿‘è·é›¢é» (å…¬åˆ†)</span>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #dc2626; font-weight: bold;">é» 1 - é€Ÿåº¦</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[0].speed" 
                                    step="0.1"
                                    min="0.1"
                                    max="20"
                                >
                                <span class="help-text">æ’­æ”¾é€Ÿåº¦å€ç‡ (é€šå¸¸æœ€å¤§)</span>
                            </div>
                        </div>

                        <!-- é» 2: ä¸­é–“è·é›¢ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px;">
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #ea580c; font-weight: bold;">é» 2 - è·é›¢ (ä¸­é–“)</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[1].distance" 
                                    step="5"
                                    min="10"
                                    max="1000"
                                >
                                <span class="help-text">ä¸­é–“è·é›¢é» (å…¬åˆ†)</span>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #ea580c; font-weight: bold;">é» 2 - é€Ÿåº¦</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[1].speed" 
                                    step="0.1"
                                    min="0.1"
                                    max="20"
                                >
                                <span class="help-text">æ’­æ”¾é€Ÿåº¦å€ç‡ (ä¸­ç­‰é€Ÿåº¦)</span>
                            </div>
                        </div>

                        <!-- é» 3: æœ€é è·é›¢ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px;">
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #2563eb; font-weight: bold;">é» 3 - è·é›¢ (æœ€é )</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[2].distance" 
                                    step="5"
                                    min="10"
                                    max="1000"
                                >
                                <span class="help-text">æœ€é è·é›¢é» (å…¬åˆ†)</span>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label style="color: #2563eb; font-weight: bold;">é» 3 - é€Ÿåº¦</label>
                                <input 
                                    type="number" 
                                    v-model.number="config.speedInterpolation.points[2].speed" 
                                    step="0.1"
                                    min="0.1"
                                    max="20"
                                >
                                <span class="help-text">æ’­æ”¾é€Ÿåº¦å€ç‡ (é€šå¸¸æœ€å°)</span>
                            </div>
                        </div>

                        <!-- é©—è­‰æç¤º -->
                        <div v-if="!validateInterpolationPoints()" class="info-box" style="background: #fef2f2; border-color: #dc2626; color: #991b1b; margin-top: 10px;">
                            âš ï¸ è­¦å‘Š: è·é›¢é»å¿…é ˆç”±å°åˆ°å¤§æ’åˆ—,è«‹èª¿æ•´æ•¸å€¼
                        </div>
                    </div>

                    <!-- å‚³çµ±é›™é»æ¨¡å¼è¨­å®š -->
                    <div v-show="!config.speedInterpolation.enabled" style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #4b5563;">ğŸ“Š å‚³çµ±é›™é»ç·šæ€§æ¨¡å¼</h3>
                        <p class="help-text" style="margin-bottom: 15px;">
                            ä½¿ç”¨æœ€å°è·é›¢å’Œæœ€å¤§è·é›¢å…©å€‹ç«¯é»é€²è¡Œç·šæ€§æ’å€¼è¨ˆç®—æ’­æ”¾é€Ÿåº¦
                        </p>

                        <div class="form-group">
                            <label>æœ€å°è·é›¢ (minDistance)</label>
                            <input 
                                type="number" 
                                v-model.number="config.distance.minDistance" 
                                step="10"
                                min="30"
                            >
                            <span class="help-text">è§¸ç™¼æœ€å¤§é€Ÿåº¦çš„æœ€è¿‘è·é›¢ (å…¬åˆ†)</span>
                        </div>

                        <div class="form-group">
                            <label>æœ€å¤§è·é›¢ (maxDistance)</label>
                            <input 
                                type="number" 
                                v-model.number="config.distance.maxDistance" 
                                step="10"
                                min="100"
                            >
                            <span class="help-text">è§¸ç™¼åŸºç¤é€Ÿåº¦çš„æœ€é è·é›¢ (å…¬åˆ†)</span>
                        </div>
                    </div>

                    <hr style="margin: 30px 0; border: none; border-top: 2px solid #e5e7eb;">
                    <h3 style="color: #374151;">âš™ï¸ é€²éšåµæ¸¬åƒæ•¸</h3>

                    <div class="form-group">
                        <label>è·é›¢è®ŠåŒ–é–¾å€¼ (distanceThreshold)</label>
                        <input 
                            type="number" 
                            v-model.number="config.distance.distanceThreshold" 
                            step="1"
                            min="1"
                        >
                        <span class="help-text">å¿½ç•¥å°æ–¼æ­¤å€¼çš„è·é›¢è®ŠåŒ– (å…¬åˆ†)</span>
                    </div>

                    <div class="form-group">
                        <label>å¹³æ»‘ä¿‚æ•¸ (smoothingFactor)</label>
                        <input 
                            type="number" 
                            v-model.number="config.distance.smoothingFactor" 
                            step="0.05"
                            min="0"
                            max="1"
                        >
                        <span class="help-text">è·é›¢è³‡æ–™å¹³æ»‘è™•ç†å¼·åº¦ (0-1)</span>
                    </div>

                    <div class="form-group">
                        <label>å•Ÿå‹•å»¶é² (activationDelay)</label>
                        <input 
                            type="number" 
                            v-model.number="config.distance.activationDelay" 
                            step="50"
                            min="0"
                        >
                        <span class="help-text">åµæ¸¬åˆ°äººè‡‰å¾Œå»¶é²é–‹å§‹èª¿æ•´é€Ÿåº¦ (æ¯«ç§’)</span>
                    </div>

                    <div class="form-group">
                        <label>åœç”¨å»¶é² (deactivationDelay)</label>
                        <input 
                            type="number" 
                            v-model.number="config.distance.deactivationDelay" 
                            step="50"
                            min="0"
                        >
                        <span class="help-text">äººè‡‰æ¶ˆå¤±å¾Œå»¶é²é–‹å§‹å›å¾©é€Ÿåº¦ (æ¯«ç§’)</span>
                    </div>

                    <div class="form-group">
                        <label>ç„¡äººè‡‰é€¾æ™‚ (noFaceTimeout)</label>
                        <input 
                            type="number" 
                            v-model.number="config.distance.noFaceTimeout" 
                            step="500"
                            min="1000"
                        >
                        <span class="help-text">æŒçºŒåµæ¸¬ä¸åˆ°äººè‡‰å¾Œå›å¾©åŸºç¤é€Ÿåº¦ (æ¯«ç§’)</span>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.distance.closestPersonMode">
                            å¤šäººæ™‚é¸å–æœ€è¿‘çš„äºº
                        </label>
                    </div>
                </section>

                <!-- é¡¯ç¤ºæ¨¡å¼æ§åˆ¶ -->
                <section v-show="currentTab === 'display'" class="panel">
                    <h2>é¡¯ç¤ºæ¨¡å¼æ§åˆ¶</h2>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.debugMode">
                            é™¤éŒ¯æ¨¡å¼ (Debug Mode)
                        </label>
                        <span class="help-text">é¡¯ç¤ºæ‰€æœ‰å³æ™‚ç‹€æ…‹è³‡è¨Š</span>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.exhibitionMode">
                            å±•è¦½æ¨¡å¼ (Exhibition Mode)
                        </label>
                        <span class="help-text">å…¨è¢å¹•æ’­æ”¾,éš±è—æ‰€æœ‰ UI å…ƒç´ </span>
                    </div>

                    <h3>é™¤éŒ¯æ¨¡å¼é¸é …</h3>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.showSpeed">
                            é¡¯ç¤ºæ’­æ”¾é€Ÿåº¦
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.showDistance">
                            é¡¯ç¤ºåµæ¸¬è·é›¢
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.showFaceCount">
                            é¡¯ç¤ºäººè‡‰æ•¸é‡
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.showFPS">
                            é¡¯ç¤º FPS
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="config.display.showCameraPreview">
                            é¡¯ç¤ºæ”å½±æ©Ÿé è¦½
                        </label>
                    </div>

                    <div class="form-group">
                        <label>æ¸¸æ¨™éš±è—å»¶é² (cursorHideDelay)</label>
                        <input 
                            type="number" 
                            v-model.number="config.display.cursorHideDelay" 
                            step="100"
                            min="0"
                        >
                        <span class="help-text">ç„¡ç§»å‹•æ™‚æ¸¸æ¨™æ¶ˆå¤±æ™‚é–“ (æ¯«ç§’)</span>
                    </div>

                    <div class="info-box">
                        <p><strong>å¿«æ·éµ:</strong> æ’­æ”¾é é¢æŒ‰ Ctrl+Shift+D åˆ‡æ›é™¤éŒ¯æ¨¡å¼</p>
                        <p><strong>å¿«æ·éµ:</strong> æ’­æ”¾é é¢æŒ‰ Ctrl+Shift+E åˆ‡æ›å±•è¦½æ¨¡å¼</p>
                    </div>
                </section>

                <!-- å½±ç‰‡ç®¡ç† -->
                <section v-show="currentTab === 'videos'" class="panel">
                    <h2>å½±ç‰‡ç®¡ç†</h2>
                    
                    <div class="upload-section">
                        <h3>ä¸Šå‚³å½±ç‰‡</h3>
                        <div class="upload-form">
                            <input 
                                type="file" 
                                ref="fileInput"
                                @change="onFileSelected"
                                accept="video/mp4,video/webm,video/ogg"
                            >
                            <button 
                                @click="uploadVideo" 
                                :disabled="!selectedFile || uploading"
                                class="btn btn-primary"
                            >
                                {{ uploading ? 'ä¸Šå‚³ä¸­...' : 'ä¸Šå‚³å½±ç‰‡' }}
                            </button>
                        </div>
                        <p class="help-text">æ”¯æ´æ ¼å¼: MP4, WebM, OGG (æœ€å¤§ 500MB)</p>
                        <p class="help-text">å»ºè­°: WebM (VP9), 1920x1080, 5-8 Mbps</p>
                    </div>

                    <div class="video-list">
                        <h3>å½±ç‰‡åˆ—è¡¨</h3>
                        <div v-if="videos.length === 0" class="empty-state">
                            å°šç„¡å½±ç‰‡
                        </div>
                        <div v-else class="video-items">
                            <div 
                                v-for="video in videos" 
                                :key="video.filename"
                                class="video-item"
                                :class="{ active: video.filename === config.video.currentVideo }"
                            >
                                <div class="video-info">
                                    <div class="video-name">{{ video.filename }}</div>
                                    <div class="video-meta">
                                        å¤§å°: {{ formatFileSize(video.size) }}
                                    </div>
                                </div>
                                <div class="video-actions">
                                    <button 
                                        @click="setCurrentVideo(video.filename)"
                                        class="btn btn-sm btn-primary"
                                        :disabled="video.filename === config.video.currentVideo"
                                    >
                                        {{ video.filename === config.video.currentVideo ? 'ä½¿ç”¨ä¸­' : 'è¨­ç‚ºä¸»å½±ç‰‡' }}
                                    </button>
                                    <button 
                                        @click="deleteVideo(video.filename)"
                                        class="btn btn-sm btn-danger"
                                        :disabled="video.filename === config.video.currentVideo"
                                    >
                                        åˆªé™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="action-bar">
                    <button @click="resetConfig" class="btn btn-warning">é‡ç½®ç‚ºé è¨­å€¼</button>
                    <button @click="saveConfig" class="btn btn-success">å„²å­˜æ‰€æœ‰è¨­å®š</button>
                </div>

                <!-- è¨Šæ¯æç¤º -->
                <div v-if="message" :class="['message', message.type]">
                    {{ message.text }}
                </div>
            </main>
        </div>
    </div>

    <script src="/js/api-client.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentTab: 'video',
                    config: {
                        video: {
                            currentVideo: '',
                            baseSpeed: 1.0,
                            maxSpeed: 10.0,
                            minSpeed: 0.25,
                            loop: true,
                            muted: false,
                            autoplay: true,
                            transitionTime: 500,
                            reverseMode: false,
                            speedControlMode: 'interpolation'
                        },
                        speedInterpolation: {
                            enabled: true,
                            points: [
                                { distance: 130, speed: 8.0 },
                                { distance: 150, speed: 3.0 },
                                { distance: 170, speed: 0.5 }
                            ]
                        },
                        distance: {
                            minDistance: 50,
                            maxDistance: 500,
                            closestPersonMode: true,
                            distanceThreshold: 10,
                            smoothingFactor: 0.3,
                            activationDelay: 300,
                            deactivationDelay: 1000,
                            noFaceTimeout: 3000
                        },
                        display: {
                            debugMode: false,
                            showSpeed: true,
                            showDistance: true,
                            showFaceCount: true,
                            showFPS: true,
                            showCameraPreview: false,
                            cursorHideDelay: 2000,
                            exhibitionMode: false
                        },
                        calibration: { defaultPresets: [] }
                    },
                    videos: [],
                    selectedFile: null,
                    uploading: false,
                    message: null
                };
            },
            mounted() {
                this.loadConfig();
                this.loadVideos();
            },
            methods: {
                async loadConfig() {
                    try {
                        const response = await apiClient.getConfig();
                        this.config = response.data;
                        this.showMessage('è¨­å®šå·²è¼‰å…¥', 'success');
                    } catch (error) {
                        this.showMessage('è¼‰å…¥è¨­å®šå¤±æ•—: ' + error.message, 'error');
                    }
                },
                async saveConfig() {
                    try {
                        // é©—è­‰æ’å€¼é»é †åº
                        if (this.config.speedInterpolation.enabled && !this.validateInterpolationPoints()) {
                            this.showMessage('é€Ÿåº¦æ’å€¼é»è·é›¢å¿…é ˆç”±å°åˆ°å¤§æ’åˆ—', 'error');
                            return;
                        }

                        const configToSave = {
                            video: this.config.video,
                            speedInterpolation: this.config.speedInterpolation,
                            distance: this.config.distance,
                            display: this.config.display
                        };
                        await apiClient.updateConfig(configToSave);
                        this.showMessage('è¨­å®šå·²å„²å­˜', 'success');
                        await this.loadConfig();
                    } catch (error) {
                        this.showMessage('å„²å­˜è¨­å®šå¤±æ•—: ' + error.message, 'error');
                    }
                },
                onModeChange() {
                    // åˆ‡æ›æ¨¡å¼æ™‚æ›´æ–° speedControlMode
                    this.config.video.speedControlMode = this.config.speedInterpolation.enabled ? 'interpolation' : 'linear';
                    this.config.video.transitionTime = 0; // ç¢ºä¿å³æ™‚åˆ‡æ›
                },
                validateInterpolationPoints() {
                    // é©—è­‰ä¸‰å€‹é»çš„è·é›¢æ˜¯å¦éå¢
                    if (!this.config.speedInterpolation.points || this.config.speedInterpolation.points.length < 3) {
                        return false;
                    }
                    const p1 = this.config.speedInterpolation.points[0].distance;
                    const p2 = this.config.speedInterpolation.points[1].distance;
                    const p3 = this.config.speedInterpolation.points[2].distance;
                    return p1 < p2 && p2 < p3;
                },
                async resetConfig() {
                    if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­å®šç‚ºé è¨­å€¼å—ï¼Ÿ')) return;
                    
                    try {
                        const response = await apiClient.resetConfig();
                        this.config = response.data;
                        this.showMessage('è¨­å®šå·²é‡ç½®', 'success');
                    } catch (error) {
                        this.showMessage('é‡ç½®è¨­å®šå¤±æ•—: ' + error.message, 'error');
                    }
                },
                async loadVideos() {
                    try {
                        const response = await apiClient.getVideoList();
                        this.videos = response.data;
                    } catch (error) {
                        this.showMessage('è¼‰å…¥å½±ç‰‡åˆ—è¡¨å¤±æ•—: ' + error.message, 'error');
                    }
                },
                onFileSelected(event) {
                    this.selectedFile = event.target.files[0];
                },
                async uploadVideo() {
                    if (!this.selectedFile) return;

                    this.uploading = true;
                    try {
                        await apiClient.uploadVideo(this.selectedFile);
                        this.showMessage('å½±ç‰‡ä¸Šå‚³æˆåŠŸ', 'success');
                        this.selectedFile = null;
                        this.$refs.fileInput.value = '';
                        await this.loadVideos();
                    } catch (error) {
                        this.showMessage('ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
                    } finally {
                        this.uploading = false;
                    }
                },
                async setCurrentVideo(filename) {
                    try {
                        await apiClient.setCurrentVideo(filename);
                        this.config.video.currentVideo = filename;
                        this.showMessage('ç•¶å‰å½±ç‰‡å·²æ›´æ–°', 'success');
                    } catch (error) {
                        this.showMessage('è¨­å®šå¤±æ•—: ' + error.message, 'error');
                    }
                },
                async deleteVideo(filename) {
                    if (!confirm(`ç¢ºå®šè¦åˆªé™¤å½±ç‰‡ "${filename}" å—ï¼Ÿ`)) return;

                    try {
                        await apiClient.deleteVideo(filename);
                        this.showMessage('å½±ç‰‡å·²åˆªé™¤', 'success');
                        await this.loadVideos();
                        await this.loadConfig();
                    } catch (error) {
                        this.showMessage('åˆªé™¤å¤±æ•—: ' + error.message, 'error');
                    }
                },
                applyPreset(preset) {
                    this.config.video.baseSpeed = preset.baseSpeed;
                    this.config.video.maxSpeed = preset.maxSpeed;
                    this.config.distance.minDistance = preset.minDistance;
                    this.config.distance.maxDistance = preset.maxDistance;
                    this.showMessage(`å·²å¥—ç”¨é è¨­: ${preset.name}`, 'info');
                },
                formatFileSize(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
                },
                showMessage(text, type = 'info') {
                    this.message = { text, type };
                    setTimeout(() => {
                        this.message = null;
                    }, 3000);
                }
            }
        }).mount('#admin-app');
    </script>
</body>
</html>
