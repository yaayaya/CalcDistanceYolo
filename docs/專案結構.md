# 📁 專案結構說明

本文件說明重組後的專案結構及各目錄用途。

## 目錄結構

```
CalcDistanceYolo/
├── backend/                    # 後端服務 (FastAPI)
│   ├── app/                   # 應用程式碼
│   │   ├── api/              # API 路由
│   │   │   ├── frontend.py   # RESTful API
│   │   │   └── websocket.py  # WebSocket 路由
│   │   ├── models/           # 資料模型
│   │   │   └── schemas.py    # Pydantic 模型定義
│   │   ├── services/         # 核心服務
│   │   │   ├── calculator.py           # 距離計算服務
│   │   │   ├── connection_manager.py   # WebSocket 連線管理
│   │   │   └── detector.py             # YOLO 偵測服務
│   │   └── utils/            # 工具函式
│   │       └── config_loader.py        # 設定檔載入器
│   ├── configs/              # 網路設定檔
│   │   └── network_config.json        # WebSocket 設定 (API 可修改)
│   ├── main.py               # FastAPI 主程式進入點
│   ├── sensor_config.json    # 感測器設定檔 (GUI 工具修改)
│   └── config.json           # (已棄用,保留相容性)
│
├── frontend/                   # 前端介面 (管理後台)
│   ├── index.html             # 管理後台主頁
│   ├── script.js              # JavaScript 程式碼
│   └── style.css              # 樣式表
│
├── models/                     # AI 模型檔案
│   └── yolo11n.pt             # YOLO11n 模型權重
│
├── tools/                      # 輔助工具
│   └── 基本偵測/               # 焦距校準工具
│       ├── camera_test_gui_v2.py      # GUI 校準工具
│       └── sensor_config註解.json      # 設定檔範例
│
├── docs/                       # 專案文件
│   ├── 原始README.md           # 完整的原始說明文件
│   ├── 快速啟動.md             # 快速啟動指南
│   └── 規劃.md                 # 專案規劃文件
│
├── README.md                   # 專案簡介 (精簡版)
├── requirements.txt            # Python 依賴套件
├── run.py                      # Python 啟動腳本
├── run.bat                     # Windows 批次啟動腳本
├── .gitignore                  # Git 忽略規則
└── .gitattributes             # Git 屬性設定
```

## 各目錄說明

### 📦 backend/

後端服務主目錄,包含所有 FastAPI 相關程式碼。

**重要檔案:**
- `main.py` - FastAPI 應用進入點,定義路由和生命週期管理
- `sensor_config.json` - 感測器與 YOLO 模型設定,由 GUI 工具修改
- `configs/network_config.json` - WebSocket 網路設定,可透過 API 修改

**子目錄:**
- `app/api/` - RESTful API 和 WebSocket 路由定義
- `app/models/` - Pydantic 資料模型
- `app/services/` - 核心業務邏輯 (偵測、計算、連線管理)
- `app/utils/` - 工具函式 (設定檔載入等)

### 🎨 frontend/

管理後台介面,使用原生 HTML/CSS/JavaScript 開發。

**功能:**
- 即時監控偵測狀態
- 修改網路設定
- 控制偵測器 (重啟、刷新連線)
- 查看 API 文件

### 🤖 models/

存放 AI 模型權重檔案。

**檔案:**
- `yolo11n.pt` - YOLO11n 模型權重 (由 Ultralytics 預訓練)

### 🛠️ tools/

輔助工具目錄。

**子目錄:**
- `基本偵測/` - 焦距校準 GUI 工具
  - 用於首次部署時校準攝影機焦距參數
  - 修改 `backend/sensor_config.json` 的焦距設定

### 📚 docs/

專案文件目錄。

**檔案:**
- `原始README.md` - 完整的技術文件和 API 說明
- `快速啟動.md` - 快速部署指南
- `規劃.md` - 專案規劃與需求文件

## 啟動方式

### 方式 1: 使用啟動腳本 (推薦)

```powershell
# Python 腳本
python run.py

# 或使用批次檔
run.bat
```

### 方式 2: 直接進入 backend 目錄

```powershell
cd backend
python main.py
```

### 方式 3: 使用 uvicorn

```powershell
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

## 設定檔說明

### sensor_config.json (後端/感測器設定)

**位置:** `backend/sensor_config.json`

**修改方式:** 透過 `tools/基本偵測/camera_test_gui_v2.py` GUI 工具修改

**包含設定:**
- YOLO 模型參數 (model_path, imgsz, conf, iou...)
- 距離計算參數 (focal_length, real_person_height...)
- 攝影機設定 (source, width, height)
- 效能設定 (fps_limit, target_fps...)

### network_config.json (網路設定)

**位置:** `backend/configs/network_config.json`

**修改方式:** 透過後台管理介面 API 修改

**包含設定:**
- WebSocket 主機/埠號
- 廣播間隔 (broadcast_interval)

## 重組變更摘要

### 移動的檔案

| 原位置 | 新位置 | 說明 |
|--------|--------|------|
| `app/` | `backend/app/` | FastAPI 應用程式碼 |
| `main.py` | `backend/main.py` | FastAPI 進入點 |
| `config.json` | `backend/config.json` | 舊設定檔 (已棄用) |
| `sensor_config.json` | `backend/sensor_config.json` | 感測器設定 |
| `configs/` | `backend/configs/` | 網路設定目錄 |
| `admin/` | `frontend/` | 管理後台介面 |
| `基本偵測/yolo11n.pt` | `models/yolo11n.pt` | YOLO 模型 |
| `基本偵測/` | `tools/基本偵測/` | 校準工具 |
| `README.md` | `docs/原始README.md` | 原始文件 |
| `快速啟動.md` | `docs/快速啟動.md` | 快速指南 |
| `規劃.md` | `docs/規劃.md` | 規劃文件 |

### 新增的檔案

- `README.md` - 精簡的專案簡介
- `run.py` - Python 啟動腳本
- `run.bat` - Windows 批次啟動腳本
- `docs/專案結構.md` - 本文件

### 程式碼修改

1. **backend/main.py**
   - 修改靜態檔案路徑: `admin` → `../frontend`

2. **backend/app/utils/config_loader.py**
   - 更新模型路徑搜尋順序:
     1. `models/yolo11n.pt` (新位置)
     2. `backend/yolo11n.pt` (兼容舊路徑)
     3. `tools/基本偵測/yolo11n.pt` (兼容舊路徑)

## 注意事項

1. **工作目錄**: 啟動腳本會自動切換工作目錄到 `backend/`,確保相對路徑正確
2. **模型位置**: 模型檔案必須放在 `models/` 目錄,或更新 `sensor_config.json` 的 `model_path`
3. **前端路徑**: 後台管理介面透過 `/admin` 路徑存取,實際檔案在 `frontend/`
4. **設定檔**: 
   - `sensor_config.json` 由 GUI 工具修改,後端只讀取
   - `network_config.json` 由後台 API 修改
5. **兼容性**: 保留了舊路徑的兼容性,但建議使用新的目錄結構

## 常見問題

**Q: 為什麼要重組目錄結構?**

A: 為了讓專案根目錄更乾淨整潔,將功能相關的檔案分類到不同目錄:
- 程式碼 → `backend/` 和 `frontend/`
- 文件 → `docs/`
- 模型 → `models/`
- 工具 → `tools/`

**Q: 舊的啟動方式還能用嗎?**

A: 可以,直接進入 `backend/` 目錄執行 `python main.py` 仍然有效。

**Q: 如何更新模型檔案?**

A: 將新的 `.pt` 模型檔案放到 `models/` 目錄,並更新 `backend/sensor_config.json` 的 `model.model_path` 參數。

**Q: 前端檔案可以自訂嗎?**

A: 可以,修改 `frontend/` 目錄下的 HTML/CSS/JS 檔案即可,無需重啟服務 (靜態檔案)。

---

**文件建立日期:** 2025-11-08  
**專案版本:** 1.0.0
